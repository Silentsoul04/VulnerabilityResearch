import os
import shutil

'''used to separate juliet SQL files over between Vulner and NonVulner. No need to run'''

destinationPathVulner = os.path.join('C:/', 'Wayne 2018-19', 'Thesis', 'julietSQL', 'Vulnerable')
destinationPathNonvulner = os.path.join('C:/', 'Wayne 2018-19', 'Thesis', 'julietSQL', 'Nonvulnerable')

def getFileSet():
    '''grabs CWE-89 Files'''
    #get directory
    dir_path = os.path.join('C:/', 'Wayne 2018-19', 'Thesis', 'julietSQL')

    #parse through FileSet
    fileList = []
    for root, dirs, files in os.walk(dir_path):
        for name in files:
            currentFile = os.path.join(root, name)  
            fileList.append(currentFile)
    return fileList
    #return len(fileList)

def isSQLVFile(fileDir):
    statementFound = False

    if "CWE_89_" in fileDir: #check for CWE 89, SQL injection
        with open(fileDir, encoding="utf8") as file:
            for i, line in enumerate(file):
                if "Unsafe" in line:
                    statementFound = True
    return statementFound

def copyToDestination(fileList):
    for file in fileList:
        if isSQLVFile(file):
            shutil.copy(file, destinationPathVulner)
        else:
            shutil.copy(file, destinationPathNonvulner)

fileList = getFileSet()
copyToDestination(fileList)
